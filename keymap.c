#include QMK_KEYBOARD_H

enum sofle_layers {
    DEF,
    GAM,
    COL,
    SYM,
    FUN,
    NUM,
};

enum custom_keycodes {
    KC_CYC = SAFE_RANGE,
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

    /*
     * DEFAULT
     * ,-----------------------------------------.                     ,-----------------------------------------.
     * | ESC  |   1  |   2  |   3  |   4  |   5  |                     |   6  |   7  |   8  |   9  |   0  | Bspc |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * | Tab  |   Q  |   W  |   E  |   R  |   T  |                     |   Y  |   U  |   I  |   O  |   P  |  \   |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |LShift|   A  |   S  |   D  |   F  |   G  |-------.    ,--------|   H  |   J  |   K  |   L  |   ;  |  '   |
     * |------+------+------+------+------+------|  Mute |    | KC_CYC |------+------+------+------+------+------|
     * |LCtrl |   Z  |   X  |   C  |   V  |   B  |-------|    |--------|   N  |   M  |   ,  |   .  |   /  | Alt  |
     * `-----------------------------------------/       /     \       \-----------------------------------------'
     *            |MO(NUM)| Super| LAlt |MO(SYM)/ Enter /       \ Space \MO(FUN) | Ctrl | Down |  Up  |
     *            |       |      |      |      /       /         \       \       |      |      |      |
     *            `-----------------------------------'           '------''---------------------------'
     */

	[DEF] = LAYOUT(
        KC_ESC,    KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                            KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_BSPC,
        KC_TAB,    KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                            KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_BSLS,
        KC_LSFT,   KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                            KC_H,    KC_J,    KC_K,    KC_L,    KC_SCLN, KC_QUOT,
        KC_LCTL,   KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,    KC_MUTE,       KC_CYC,  KC_N,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH, KC_RALT,
                            MO(NUM), KC_LGUI, KC_LALT, MO(SYM), KC_ENT,        KC_SPC,  MO(FUN), KC_RCTL, KC_DOWN, KC_UP
    ),

    /*
     * GAMES
     * ,-----------------------------------------.                     ,-----------------------------------------.
     * | ESC  |   1  |  2   |   3  |   4  |   5  |                     |   6  |   7  |   8  |   9  |   0  | Bspc |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * | Tab  |   Q  |   W  |   E  |   R  |   T  |                     |   Y  |   U  |   I  |   O  |   P  |      |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |LShift|   A  |   S  |   D  |   F  |   G  |-------.    ,--------|   H  |   J  |   K  |   L  |   ;  |  '   |
     * |------+------+------+------+------+------|  Mute |    | KC_CYC |------+------+------+------+------+------|
     * |LCtrl |   Z  |   X  |   C  |   V  |   B  |-------|    |--------|   N  |   M  |   ,  |   .  |   /  |RShift|
     * `-----------------------------------------/       /     \       \-----------------------------------------'
     *            |MO(NUM)| Alt | Space| MO(SYM)/ Enter /       \ Space \MO(FUN) | Down |  Up  |RCtrl |
     *            |      |      |      |       /       /         \       \       |      |      |      |
     *            `-----------------------------------'           '------''---------------------------'
     */

	[GAM] = LAYOUT(
        KC_ESC,    KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                            KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_BSPC,
        KC_TAB,    KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                            KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_BSLS,
        KC_LSFT,   KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                            KC_H,    KC_J,    KC_K,    KC_L,    KC_SCLN, KC_QUOT,
        KC_LCTL,   KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,    KC_MUTE,       KC_CYC,  KC_N,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH, KC_RALT,
                            MO(NUM), KC_LALT, KC_SPC,  MO(SYM), KC_ENT,        KC_SPC, MO(FUN),  KC_RCTL, KC_DOWN, KC_UP
    ),

    /*
     * Colemak
     * ,-----------------------------------------.                     ,-----------------------------------------.
     * | ESC  |   1  |  2   |   3  |   4  |   5  |                     |   6  |   7  |   8  |   9  |   0  | Bspc |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * | Tab  |   Q  |   W  |   F  |   P  |   B  |                     |   J  |   L  |   U  |   Y  |   ;  |      |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |LShift|   A  |   R  |   S  |   T  |   G  |-------.    ,--------|   M  |   N  |   E  |   I  |   O  |  '   |
     * |------+------+------+------+------+------|  Mute |    | KC_CYC |------+------+------+------+------+------|
     * |LCtrl |   Z  |   X  |   C  |   D  |   V  |-------|    |--------|   K  |   M  |   ,  |   .  |   /  | Alt  |
     * `-----------------------------------------/       /     \       \-----------------------------------------'
     *            |MO(NUM)| Super| LAlt |MO(SYM)/ Enter /       \ Space \MO(FUN) | Ctrl | Down |  Up  |
     *            |       |      |      |      /       /         \       \       |      |      |      |
     *            `-----------------------------------'           '------''---------------------------'
     */
	[COL] = LAYOUT(
        KC_ESC,   KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                          KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_BSPC,
        KC_TAB,   KC_Q,    KC_W,    KC_F,    KC_P,    KC_B,                          KC_J,    KC_L,    KC_U,    KC_Y,    KC_SCLN, KC_BSLS,
        KC_LSFT,  KC_A,    KC_R,    KC_S,    KC_T,    KC_G,                          KC_M,    KC_N,    KC_E,    KC_I,    KC_O,    KC_QUOT,
        KC_LCTL,  KC_Z,    KC_X,    KC_C,    KC_D,    KC_V,   KC_MUTE,       KC_CYC ,KC_K,    KC_H,    KC_COMM, KC_DOT,  KC_SLSH, KC_RALT,
                           MO(NUM), KC_LGUI, KC_LALT, MO(SYM),KC_ENT,        KC_SPC, MO(FUN), KC_RCTL, KC_DOWN, KC_UP
    ),

    /*
     * Symbols
     * ,-----------------------------------------.                     ,-----------------------------------------.
     * |  ~   |  `   |      |      |      |      |                     |      |      |      |      |      |      |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |      |      |      |  /   |  *   |      |                     |      |  [   |  ]   |      |      |      |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |      |      |  -   |  +   |   =  |      |-------.    ,--------|   _  |  {   |  }   |      |      |      |
     * |------+------+------+------+------+------|       |    |        |------+------+------+------+------+------|
     * |      |      |      |      |      |      |-------|    |--------|      |      |      |      |      |      |
     * `-----------------------------------------/       /     \       \-----------------------------------------'
     *            |      |      |      | KC_TRNS/       /       \       \ KC_TRNS|      |      |      |
     *            |      |      |      |       /       /         \       \       |      |      |      |
     *            `-----------------------------------'           '------''---------------------------'
     */

	[SYM] = LAYOUT(
        KC_TILD,  KC_GRV,  KC_NO,   KC_NO,   KC_NO,   KC_NO,                          KC_NO,  KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,
        KC_NO,    KC_NO,   KC_NO,   KC_PSLS, KC_PAST, KC_NO,                          KC_NO,  KC_LBRC, KC_RBRC, KC_NO,   KC_NO,   KC_NO,
        KC_NO,    KC_NO,   KC_MINS, KC_PPLS, KC_EQL,  KC_NO,                          KC_UNDS,KC_LCBR, KC_RCBR, KC_NO,   KC_NO,   KC_NO,
        KC_NO,    KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,         KC_NO,  KC_NO,  KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,
                           KC_NO,   KC_NO,   KC_NO,   KC_TRNS, KC_NO,         KC_NO,  KC_NO,  KC_NO,   KC_NO,   KC_NO
    ),

    /*
     * Function
     * ,-----------------------------------------.                     ,-----------------------------------------.
     * |  F1  |  F2  |  F3  |  F4  |  F5  |  F6  |                     |  F7  |  F8  |  F9  | F10  | F11  | F12  |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |      |      |      |      |      |      |                     |      |      |      | Prev | Next | Play |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |      |      |      |      |      |      |-------.    ,--------|      | Del  |  Up  | Prnt |      |      |
     * |------+------+------+------+------+------|       |    |        |------+------+------+------+------+------|
     * |      |      |      |      |      |      |-------|    |--------|      | Right| Down | Left |      |      |
     * `-----------------------------------------/       /     \       \-----------------------------------------'
     *            |      |      |      |        /       /       \       \ KC_TRNS|      |      |      |
     *            |      |      |      |       /       /         \       \       |      |      |      |
     *            `-----------------------------------'           '------''---------------------------'
     */

	[FUN] = LAYOUT(
        KC_NO,    KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,                         KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10,  KC_F11,
        KC_NO,    KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,                         KC_NO,   KC_NO,   KC_MPRV, KC_MNXT, KC_MPLY, KC_F12,
        KC_NO,    KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,                         KC_NO,   KC_DEL,  KC_UP,   KC_PSCR, KC_NO,   KC_NO,
        KC_NO,    KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,  KC_NO,         KC_NO,  KC_NO,   KC_LEFT, KC_DOWN, KC_RIGHT,KC_NO,   KC_NO,
                           KC_NO,   KC_NO,   KC_NO,   KC_NO,  KC_NO,         KC_NO,  KC_TRNS, KC_NO,   KC_NO,   KC_NO
    ),

    /*
     * NUMPAD
     * ,-----------------------------------------.                     ,-----------------------------------------.
     * |  `   |   ~  |      |      |      |      |                     |  /   |  *   |  +   |  =   |  -   |  _   |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |      |      |      |      |      |      |                     |   7  |   8  |   9  |  [   |   ]  |  \   |
     * |------+------+------+------+------+------|                     |------+------+------+------+------+------|
     * |KC_TRNS|     |      |      |      |      |-------.    ,--------|   4  |   5  |   6  |  {   |   }  |  |   |
     * |------+------+------+------+------+------|       |    |        |------+------+------+------+------+------|
     * |      |      |      |      |      |      |-------|    |--------|   1  |   2  |   3  |      |      |      |
     * `-----------------------------------------/       /     \       \-----------------------------------------'
     *            |      |      |      | KC_TRNS/       /       \       \   0    |  .   |Enter |      |
     *            |      |      |      |       /       /         \       \       |      |      |      |
     *            `-----------------------------------'           '------''---------------------------'
     */

	[NUM] = LAYOUT(
        KC_GRV,   KC_TILD, KC_NO,   KC_NO,   KC_NO,   KC_NO,                         KC_PSLS, KC_PAST, KC_PPLS, KC_EQL,  KC_MINS,  KC_UNDS,
        KC_NO,    KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,                         KC_P7,   KC_P8,   KC_P9,   KC_LBRC, KC_RBRC, KC_BSLS,
        KC_TRNS,  KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,                         KC_P4,   KC_P5,   KC_P6,   KC_LCBR, KC_RCBR, KC_PIPE,
        KC_NO,    KC_NO,   KC_NO,   KC_NO,   KC_NO,   KC_NO,  KC_NO,         KC_NO,  KC_P1,   KC_P2,   KC_P3,   KC_NO,   KC_NO,   KC_NO,
                           KC_NO,   KC_NO,   KC_NO,   KC_TRNS,KC_NO,         KC_NO,  KC_P0,   KC_PDOT, KC_ENT,  KC_NO
    ),
};


static void print_status_narrow(void) {
    // Print current mode
    oled_write_P(PSTR("\n\n"), false);

    switch (get_highest_layer(default_layer_state)) {
        case DEF:
            oled_write_ln_P(PSTR("qwrt"), false);
            break;
        case COL:
            oled_write_ln_P(PSTR("clmk"), false);
            break;
        case GAM:
            oled_write_ln_P(PSTR("game"), false);
            break;
        default:
            oled_write_P(PSTR("undef"), false);
    }
    // Print current layer
    oled_write_P(PSTR("  -  "), false);
    switch (get_highest_layer(layer_state)) {
        case DEF:
            oled_write_P(PSTR("base\n"), false);
            break;
        case COL:
            oled_write_P(PSTR("base\n"), false);
            break;
        case SYM:
            oled_write_P(PSTR("raise\n"), false);
            break;
        case GAM:
            oled_write_P(PSTR("base\n"), false);
            break;
        case NUM:
            oled_write_P(PSTR("num\n"), false);
            break;
        case FUN:
            oled_write_P(PSTR("lower\n"), false);
            break;
        default:
            oled_write_ln_P(PSTR("huh?"), false);
    }
}

static void render_poke(void) {

    static const char PROGMEM poke[][128]= {
        //{
        //    // 'lapras', 32x32px
        //    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        //    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        //    0x00, 0x00, 0x00, 0x00, 0x08, 0xb4, 0x66, 0x0f, 0x17, 0x86, 0xce, 0x02, 0x99, 0x21, 0xe2, 0x1c,
        //    0x80, 0x80, 0x40, 0x40, 0x40, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        //    0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x04, 0x84, 0x86, 0xc4, 0x38, 0x00, 0x07, 0x03, 0x07,
        //    0x18, 0x20, 0x40, 0x40, 0x40, 0xa0, 0xa0, 0x93, 0x3c, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00,
        //    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x05, 0x05, 0x06, 0x03, 0x02, 0x04, 0x04, 0x04, 0x06,
        //    0x09, 0x08, 0x10, 0x11, 0x11, 0x13, 0x12, 0x15, 0x09, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
        //},
        {
            // 'snorlax', 32x32px
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x80, 0x40, 0x40, 0x60, 0x70, 0x70, 0x60, 0x80, 0x80, 0xc0, 0xc0, 0x40, 0xc0, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x3c, 0x3a, 0x11, 0x19, 0x0f, 0x02, 0x03,
            0xe0, 0x11, 0xd0, 0xd0, 0x12, 0xd2, 0xe0, 0xe4, 0xf1, 0xfb, 0xfc, 0x3f, 0x03, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x0e, 0x31, 0x41, 0x82, 0x86, 0x7f, 0xfc, 0xf0, 0xe0, 0xc0, 0xe0, 0x10, 0x88, 0x98,
            0x08, 0x19, 0x7d, 0xfe, 0xfe, 0xfe, 0xff, 0xff, 0x7f, 0x3f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x07, 0x0f, 0x0f,
            0x0b, 0x0c, 0x06, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        {
            // 'gengar', 32x32px
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x90, 0x20, 0x40, 0x40, 0x80, 0x00, 0x80, 0x40,
            0xc0, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x40, 0x40, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xe0, 0x13, 0x8c, 0x04, 0x00, 0x02, 0x01, 0x00, 0x00,
            0x03, 0x01, 0x04, 0x07, 0x02, 0x01, 0x81, 0xe0, 0xf0, 0xec, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x07, 0x1a, 0xe4, 0xc4, 0x88, 0x88, 0x48, 0xc9, 0x28,
            0x28, 0x14, 0x0c, 0x02, 0x90, 0x10, 0x20, 0x21, 0xeb, 0xff, 0xcf, 0x82, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x01, 0x02,
            0x02, 0x02, 0x05, 0x09, 0x08, 0x08, 0x04, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
        },
        {
            // 'Staryu', 32x32px
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xc8, 0x88, 0x98, 0x50, 0x5c, 0x23, 0x38, 0x47,
            0x43, 0xac, 0x10, 0x90, 0x90, 0x50, 0xd0, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x67, 0x79, 0x2e, 0x3b, 0x51, 0x5b, 0x2e,
            0x20, 0x59, 0x4f, 0x98, 0xbe, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        }
    };

    oled_on();
    oled_set_cursor(0, 0);
    oled_write_raw_P(poke[0], sizeof(poke[0]));

    oled_set_cursor(0, 6);
    oled_write_raw_P(poke[1], sizeof(poke[1]));

    oled_set_cursor(0, 11);
    oled_write_raw_P(poke[2], sizeof(poke[2]));
}

#define ANIM_FRAME_DURATION 250
#define ANIM_SIZE 512
#define CAT_FRAMES 3

uint32_t anim_timer = 0;
uint32_t anim_sleep = 0;
uint8_t current_frame = 0;

static void render_anim_cat(void) {

    static const char PROGMEM cat_anim[][512] = {
        {
            // 'catbus_f1', 32x128
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0,
            0x1e, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
            0x8e, 0x87, 0xc7, 0xc7, 0x47, 0x66, 0x1f, 0x08, 0x08, 0x08, 0x08, 0xc8, 0x30, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0x70, 0x38, 0x18, 0x1c, 0x0c, 0x0c, 0xfc, 0xfc,
            0x3f, 0x03, 0xc3, 0x30, 0x08, 0x6b, 0xe7, 0xe7, 0xc2, 0x85, 0x45, 0x38, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x80, 0xfc, 0xff, 0x07, 0xc0, 0x2e, 0x29, 0x29, 0x29, 0xce, 0x00, 0xff, 0xff,
            0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0xd8, 0x97, 0x11, 0x10, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0xff, 0xff, 0x03, 0x00, 0x1d, 0xa5, 0xa5, 0xa5, 0xa5, 0x9c, 0x00, 0xff, 0xff,
            0x00, 0x00, 0x00, 0x08, 0x08, 0x0b, 0x97, 0x27, 0x7f, 0x86, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x0f, 0xff, 0xf0, 0x00, 0xe3, 0x24, 0x24, 0x24, 0x24, 0xc7, 0x00, 0xff, 0xff,
            0xff, 0x00, 0x00, 0x02, 0x04, 0x07, 0x1f, 0xff, 0x20, 0x40, 0x47, 0x38, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x0f, 0x3f, 0xf8, 0xc0, 0x9d, 0x25, 0x45, 0x45, 0x3c, 0x00, 0x0f, 0xff,
            0xff, 0xf0, 0x01, 0x02, 0x0c, 0x30, 0xfc, 0x1c, 0x03, 0x1c, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x06, 0x46, 0x6c, 0xff, 0xc7, 0x12, 0x25,
            0x89, 0x20, 0xee, 0xa0, 0x44, 0x88, 0x08, 0x11, 0xf2, 0x64, 0xe4, 0x0b, 0x30, 0xc0, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x06,
            0x04, 0x0c, 0x09, 0x0e, 0x0a, 0x09, 0x06, 0x3c, 0x61, 0x46, 0x38, 0x01, 0x02, 0x01, 0x00, 0x00,
        },
        {
            // 'catbus_f2', 32x128
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8,
            0x8e, 0x87, 0xc3, 0xc3, 0xc3, 0xc6, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f,
            0xc7, 0xc7, 0xe7, 0x3b, 0x0f, 0x07, 0x87, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0x60, 0xf0, 0x30, 0x18, 0x08, 0x8c, 0xec,
            0xff, 0x03, 0x00, 0x21, 0xd3, 0xcf, 0x8b, 0x88, 0x90, 0x90, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0xe0, 0xfe, 0x0f, 0xc7, 0x58, 0x54, 0x55, 0x54, 0xdc, 0x00, 0xf0, 0xff,
            0x1f, 0x00, 0x00, 0x10, 0x30, 0x71, 0x53, 0x8f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0xff, 0xff, 0x03, 0x00, 0x3b, 0x4a, 0x4a, 0x4a, 0x5a, 0x71, 0x00, 0xff, 0xff,
            0x00, 0x00, 0x04, 0x0c, 0x08, 0x0e, 0xee, 0x10, 0x20, 0x43, 0x84, 0x88, 0x70, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0xce, 0xe9, 0x69, 0x69, 0x29, 0xee, 0x00, 0xff, 0xff,
            0xc0, 0x00, 0x40, 0x80, 0x80, 0x19, 0xf9, 0xf1, 0x42, 0xa2, 0x24, 0x4c, 0x78, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x01, 0x0f, 0x7f, 0xe0, 0x80, 0x79, 0xca, 0x8a, 0x8a, 0x9b, 0xf0, 0x03, 0xff,
            0xff, 0x00, 0x00, 0x00, 0x09, 0x09, 0x51, 0x60, 0x7c, 0x70, 0x81, 0x86, 0x58, 0x20, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x06, 0x0c, 0x18, 0x51, 0xd1, 0xf8, 0x24, 0x4f,
            0x1b, 0x42, 0xcc, 0x40, 0x80, 0x00, 0x28, 0xcf, 0x8e, 0x98, 0x28, 0xd1, 0x11, 0x0e, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x04,
            0x09, 0x10, 0x11, 0x17, 0x0a, 0x0d, 0x07, 0x03, 0x01, 0x03, 0x04, 0x04, 0x03, 0x00, 0x00, 0x00,
        },
        {
            // 'catbus_f3', 32x128
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
            0xf8, 0x8f, 0xc7, 0xc7, 0xc7, 0xc7, 0x86, 0x8c, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07,
            0xff, 0x0f, 0x87, 0x87, 0x83, 0x83, 0x83, 0xf7, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xc0, 0xe0, 0x70, 0x30, 0x30, 0x30, 0xf0,
            0xff, 0x0f, 0x07, 0x03, 0x73, 0x73, 0x63, 0xc7, 0x44, 0x4c, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0xc0, 0xf0, 0x7c, 0x0e, 0x37, 0xab, 0xa9, 0xa8, 0xb8, 0x00, 0x00, 0xfc, 0xff,
            0x3f, 0x00, 0x00, 0x40, 0x80, 0x02, 0x04, 0xcd, 0x8b, 0x16, 0x24, 0xc4, 0xf8, 0x00, 0x00, 0x00,
            0x00, 0x00, 0xff, 0xff, 0x07, 0x00, 0xe6, 0x95, 0x94, 0x94, 0x94, 0xf7, 0x00, 0x00, 0xff, 0xff,
            0x00, 0x00, 0x38, 0x60, 0xf1, 0xf3, 0x67, 0x07, 0xff, 0x18, 0x60, 0xa0, 0x21, 0x1e, 0x00, 0x00,
            0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x9e, 0x52, 0x52, 0x52, 0x52, 0xde, 0x00, 0x00, 0xff, 0xff,
            0x00, 0x00, 0x00, 0x00, 0x18, 0x23, 0x4e, 0xe4, 0x7f, 0xe2, 0x06, 0x19, 0x20, 0xc0, 0x00, 0x00,
            0x00, 0x00, 0x03, 0x3f, 0xfe, 0xc0, 0xe3, 0x34, 0x14, 0x14, 0x34, 0xf7, 0x00, 0x00, 0xff, 0xff,
            0xff, 0x00, 0x00, 0x00, 0x10, 0x48, 0xc4, 0xc7, 0xb3, 0xe2, 0x63, 0x22, 0x46, 0x39, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x0f, 0x1d, 0x31, 0x31, 0xb1, 0xf1, 0xf8, 0x5c, 0x8f, 0x37,
            0x83, 0xbc, 0x80, 0x80, 0x00, 0x08, 0x05, 0xc3, 0x3f, 0x10, 0x1d, 0x1a, 0x22, 0x24, 0x18, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x0e, 0x18, 0x22,
            0x60, 0x43, 0x4d, 0x34, 0x33, 0x1e, 0x0e, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        }
    };

    void anim_phase(void) {
        current_frame = (current_frame + 1) % CAT_FRAMES;
        oled_write_raw_P(cat_anim[abs((CAT_FRAMES - 1) - current_frame)], ANIM_SIZE);
    }

    if (timer_elapsed32(anim_sleep) > OLED_TIMEOUT) {
        oled_off();
    } else {
        if (timer_elapsed32(anim_timer) > ANIM_FRAME_DURATION) {
            oled_on();
            anim_timer = timer_read32();
            anim_phase();
        }
    }
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case KC_CYC:
            if (record->event.pressed) {
                switch (get_highest_layer(default_layer_state)) {
                    case DEF:
                        set_single_persistent_default_layer(GAM);
                        break;
                    case GAM:
                        set_single_persistent_default_layer(COL);
                        break;
                    case COL:
                        set_single_persistent_default_layer(DEF);
                        break;
                    default:
                        set_single_persistent_default_layer(DEF);
                }
            }
            return false;
        default:
            anim_sleep = timer_read32();
            return true;
    }
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    //if (is_keyboard_master()) {
        return OLED_ROTATION_270;
    //}
    //return OLED_ROTATION_180;
}

bool oled_task_user(void) {
    if (last_input_activity_elapsed() > OLED_TIMEOUT) {
        oled_off();
        return true;
    } else {
        if (is_keyboard_master()) {
            render_anim_cat();
            print_status_narrow();
        } else {
            render_poke();
            oled_scroll_left();
        }
        return true;
    }

    return false;
}

void suspend_power_down_user(void) {
    oled_off();
}

#ifdef ENCODER_ENABLE

bool encoder_update_user(uint8_t index, bool clockwise) {
    if (index == 0) {
        if (clockwise) {
            tap_code(KC_VOLU);
        } else {
            tap_code(KC_VOLD);
        }
    } else if (index == 1) {
        if (clockwise) {
            tap_code(KC_PGDN);
        } else {
            tap_code(KC_PGUP);
        }
    }
    return true;
}

#endif
